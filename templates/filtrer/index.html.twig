{% extends 'base.html.twig' %}

{% block title %}Hello FiltrerController!
{% endblock %}

{% block body %}
	<main>
		<div class="card">
			<h1>Filtrer</h1>
			<form action="{{ path('app_filtrer') }}" method="post">
				<div class="form-group">
					<label for="date">Date</label>
					<input type="week" name="date" id="date">
				</div>

				<div class="form-group">
					<label for="tp">TP</label>
					<select name="tp" id="tp">
						{% for tpOption in tpOptions %}
							<option value="{{ tpOption }}" {% if tpOption == selectedTp %} selected {% endif %}>
								{{ tpOption }}
							</option>
						{% endfor %}
					</select>
				</div>

				<button type="submit">Filtrer</button>
			</form>

			{% if filteredData %}
				<h2>Résultats :</h2>
				<ul class="work-list" id="workList">
					{% for work in filteredData %}
						{% set workId = work.date ~ '-' ~ work.titre | replace({ ' ': '', '/': '', ':': '' }) %}
						<li class="work-item" data-tp="{{ work.tp }}" data-user-tp="{{ app.session.get('user_tp') }}" data-work-id="{{ workId }}">
							<strong>{{ work.date | date('d/m/Y') }}</strong>
							-
							{{ work.titre }}
							(TP
							{{ work.tp }})
						</li>
					{% endfor %}
				</ul>
			{% else %}
				<p>Aucun travail pour la sélection actuelle.</p>
			{% endif %}
		</div>
	</main>

	<script>
		document.addEventListener("DOMContentLoaded", function () {
var workItems = document.querySelectorAll('.work-item');

workItems.forEach(function (item) {
var workId = item.getAttribute('data-work-id');
var isSelected = localStorage.getItem('selectedWork_' + workId) === 'true';

if (isSelected) {
item.classList.add('selected');
}

item.addEventListener('click', function () {
var userTp = item.getAttribute('data-user-tp');
var tp = item.getAttribute('data-tp');

if (userTp === tp) {
item.classList.toggle('selected');

// Mettre à jour le stockage local
localStorage.setItem('selectedWork_' + workId, item.classList.contains('selected').toString());
}
});
});
});
	</script>
{% endblock %}
